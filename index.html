<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>æ±Ÿå·ã•ã‚“å°‚ç”¨ã€€è¡Œå…ˆæ²ç¤ºæ¿</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background-color: #eef4f8;
      margin: 0;
      padding: 2rem;
    }

    h1 {
      text-align: center;
      color: #333;
    }

    #board {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      max-width: 600px;
      margin: 2rem auto;
    }

    .person {
      background: white;
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.06);
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      align-items: center;
    }

    .person-name {
      font-size: 1.6rem;
      font-weight: bold;
      color: #333;
    }

    .status-label {
      font-size: 1.8rem;
      font-weight: bold;
      padding: 1rem 2rem;
      border-radius: 16px;
      color: white;
      text-align: center;
      min-width: 200px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .status-å›³æ›¸é¤¨ { background-color: #03a9f4; }
    .status-ï¼¤ï¼¸ { background-color: #4caf50; }
    .status-ãã®ä»– { background-color: #607d8b; }
    .status-å¸°å®… { background-color: #f44336; }
    .status-æ›´æ–°ä¸­ { background-color: #9e9e9e; }

    .buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1rem;
    }

    button {
      padding: 0.6rem 1.2rem;
      font-size: 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: transform 0.2s, background-color 0.2s;
      color: white;
    }

    button:hover {
      transform: scale(1.05);
    }

    .btn-å›³æ›¸é¤¨ { background-color: #03a9f4; }
    .btn-ï¼¤ï¼¸ { background-color: #4caf50; }
    .btn-ãã®ä»– { background-color: #607d8b; }
    .btn-å¸°å®… { background-color: #f44336; }

    .loading {
      text-align: center;
      font-style: italic;
      color: #555;
    }
  </style>
</head>
<body>
  <h1>è¡Œå…ˆæ²ç¤ºæ¿</h1>
  <div id="board" class="loading">èª­ã¿è¾¼ã¿ä¸­...</div>

  <script>
    const apiUrl = "https://script.google.com/macros/s/AKfycbztJLvXMGxU019vtLZ9qNJzp9go7TZJ_GII3pqzTFZwNTU5PfLbUYlQ6ae1Nn4THNYlAA/exec";

    async function loadBoard() {
      const board = document.getElementById("board");
      board.innerHTML = "èª­ã¿è¾¼ã¿ä¸­...";

      try {
        const res = await fetch(apiUrl);
        if (!res.ok) throw new Error("APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¨ãƒ©ãƒ¼");

        const data = await res.json();
        board.innerHTML = "";

        if (!data || data.length === 0) {
          board.innerHTML = "è¡¨ç¤ºã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚";
          return;
        }

        data.forEach(item => {
          const div = document.createElement("div");
          div.className = "person";
          div.setAttribute("data-name", item.name);

          const statusClass = `status-label status-${item.status || 'æœªè¨­å®š'}`;

          div.innerHTML = `
            <div class="person-name">${item.name}</div>
            <div class="${statusClass}">${item.status}</div>
            <div class="buttons">
              <button class="btn-å›³æ›¸é¤¨" onclick="updateStatus('${item.name}', 'å›³æ›¸é¤¨', this)">ğŸ“šå›³æ›¸é¤¨</button>
              <button class="btn-ï¼¤ï¼¸" onclick="updateStatus('${item.name}', 'ï¼¤ï¼¸', this)">ğŸ’»ï¼¤ï¼¸</button>
              <button class="btn-ãã®ä»–" onclick="updateStatus('${item.name}', 'ãã®ä»–', this)">ğŸƒâ€â™‚ï¸ãã®ä»–</button>
              <button class="btn-å¸°å®…" onclick="updateStatus('${item.name}', 'å¸°å®…', this)">ğŸ å¸°å®…</button>
            </div>
          `;
          board.appendChild(div);
        });
      } catch (e) {
        board.innerHTML = "ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
        console.error("ã‚¨ãƒ©ãƒ¼:", e);
      }
    }

    async function updateStatus(name, status, button) {
      const personDiv = button.closest(".person");
      const statusLabel = personDiv.querySelector(".status-label");
      const originalStatus = statusLabel.textContent;

      statusLabel.textContent = "æ›´æ–°ä¸­...";
      statusLabel.className = "status-label status-æ›´æ–°ä¸­";

      try {
        const res = await fetch(apiUrl, {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: `name=${encodeURIComponent(name)}&status=${encodeURIComponent(status)}`
        });

        if (!res.ok) throw new Error("ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ã‚¨ãƒ©ãƒ¼");

        const result = await res.json();
        statusLabel.textContent = result.status;
        statusLabel.className = `status-label status-${result.status}`;
      } catch (e) {
        statusLabel.textContent = originalStatus;
        statusLabel.className = `status-label status-${originalStatus}`;
        alert("ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ");
        console.error("æ›´æ–°ã‚¨ãƒ©ãƒ¼:", e);
      }
    }

    loadBoard();
  </script>
</body>
</html>
